<div class="d-flex kita-show-all" >
  <div class="kita-show-info w-50">
    <div class="d-flex" style=" color: #f57170;">
      <h4>SELECTION</h4>
      <hr class="kindergardens-line">
    </div>
    <div class="d-flex justify-content-between">
      <div style="width: 60%; padding-right: 10px;">
        <h1><%= @kindergarden.name.upcase %></h1>
        <h4><%= @kindergarden.address %></h4>
          <p><%= @kindergarden.description %></p>
          <h4><%= @kindergarden.phone %></h4>
          <h4><%= @kindergarden.email %></h4>
      </div>
      <div id="map" style="width: 40%"
        data-markers="<%= @markers.to_json %>"
        data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"
      ></div>
    </div>
        <hr>
        <%= render "shared/kita_details", kindergarden: @kindergarden %>
        <hr>
        <%= render "shared/kita_reviews", kindergarden: @kindergarden %>
        <%= render "shared/carousel", kindergarden: @kindergarden %>
   </div>
   <div class="kita-show-form w-50">
     <div class="d-flex" style=" color: #f57170;">
      <h4>APPLY</h4>
      <hr class="kindergardens-line">
    </div>
    <div>
     <% if user_signed_in? && @kindergarden.is_available == true %>
      <% if current_user.kids.exists? && !@has_kid_in_kita %>
      <h4 style="font-weight: lighter;">Please select one of your kids and we'll guide you through the application process for this Kindergarden</h4>
       <div class="form-pink-bg">
        <%= simple_form_for([@kindergarden, @reservation]) do |f| %>
        <%= f.association :kid, collection: current_user.kids, label_method: :first_name %>
        <%= f.button :submit, class:"btn btn-white w-100" %>
      <% end %>
      </div>
      <% elsif @has_kid_in_kita %>
        <h4 style=" color: #f57170;">You cannot apply with the same kid</h4>
      <% else %>
      <div class="form-pink-bg">
      <%= simple_form_for(@kid) do |f| %>
        <%= f.error_notification %>
        <%= f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present? %>
         <% if @kid.errors.any? %>
           <div class="errors-container">
             <ul>
               <% @kid.errors.full_messages.each do |message| %>
                <li><%= message %></li>
               <% end %>
             </ul>
           </div>
          <% end %>
          <div class="form-inputs">
           <%= f.input :first_name %>
           <%= f.input :last_name %>
           <%= f.input :date_of_birth %>
           <%= f.input :gender, as: :radio_buttons,
                        collection: ['Male', 'Female', 'Non-binary'] %>
           <%= f.input :primary_language %>
           <%= f.input :secondary_language %>
          </div>
           <div class="form-actions">
             <%= f.submit 'APPLY', class:"btn btn-white w-100 font-weight-bold" %>
           </div>
          <% end %>
        </div>
      <% end %>
     <% end %>
    </div>
    <div>
    <% if @my_reservation.nil? %>
      <h4 style="font-weight: lighter; letter-spacing: 1px;">You will be able to leave a review once you have an accepted reservation in this kindergarden</h4>
    <% else %>
      <% if @kindergarden.reviews.empty? %>
        <h3>Be the first to leave a review</h3>
      <% end %>
    <% end %>
      <% if @my_reservation.present? %>
          <div class="d-flex" style=" color: #f57170;">
            <h4>REVIEW</h4>
            <hr class="kindergardens-line">
          </div>
          <div class="form-pink-bg">
          <%= simple_form_for [@my_reservation, @review] do |f| %>
           <%= f.input :rating, collection: 1..5 %>
           <%= f.input :content %>
           <%= f.submit class:"btn btn-white w-100"%>
         <% end %>
         </div>
      <% end %>
     <div><%=link_to "Back to results", session[:search_results], class:"btn btn-primary" %></div>
    </div>
   </div>
 </div>
<%= render "shared/footer", kindergarden: @kindergarden %>

